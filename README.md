# Проект WidgetForSuccessfulOperations

## Описание проекта:

Проект WidgetForSuccessfulOperations - это виджет, который показывает несколько последних успешных банковских операций
клиента.

---

## Установка
1. Клонирование репозитория
```
git clone https://github.com/ragveil/homework_bank_widget.git
```
2. Установка зависимостей
```
poetry install
```
---
## Основной функционал
Основной файл `main.py` служит для базовой проверки работы функций,
а также содержит бонусный функционал для дополнительной проверки.

---
## Описание модуля `masks`
Модуль `masks` предоставляет функции:  
`get_mask_card_number` для маскировки номеров банковских карт;  
`get_mask_account` для маскировки номеров банковского счета.

### Примеры использования модуля `masks`
```python
from src.masks import get_mask_card_number, get_mask_account

# Маскировка номера карты
card_number = '7000792289606361'
masked_card = get_mask_card_number(card_number)
print(masked_card)  # Вывод: 7000 79** **** 6361

# Маскировка номера счета
account_number = '73654108430135874305'
masked_account = get_mask_account(account_number)
print(masked_account)  # Вывод: **4305
```
---
## Описание модуля `widget`
Модуль `widget` предоставляет функции:  
`mask_account_card` для маскировки номеров банковских карт и счетов в формате "Текст номер";  
`get_date` для форматирования даты в удобочитаемый формат.


### Примеры использования модуля `widget`
```python
from src.widget import mask_account_card, get_date

# Маскировка номера карты
card_number = "Visa Gold 5999414228426353"
masked_card = mask_account_card(card_number)
print(masked_card)  # Вывод: Visa Gold 5999 41** **** 6353

# Маскировка номера счета
account_number = "Счет 73654108430135874305"
masked_account = mask_account_card(card_number)
print(masked_account)  # Вывод: Счет **4305

# Форматирование даты
date_original = "2024-03-11T02:26:18.671407"
formatted_date = get_date(date_original)
print(formatted_date)  # Вывод: 11.03.2024
```
---
## Описание модуля `processing`
Модуль `processing` предоставляет функции:
`filter_by_state` для фильтрации банковских операций по состоянию;
`sort_by_date` для сортировки банковских операций по дате.

### Примеры использования модуля `processing`
```python
from src.processing import filter_by_state, sort_by_date

# Фильтрация банковских операций
banking_operations = [
    {"id": 41428829, "state": "EXECUTED", "date": "2019-07-03T18:35:29.512364"},
    {"id": 615064591, "state": "CANCELED", "date": "2018-10-14T08:21:33.419441"}
]
filtered_operations = filter_by_state(banking_operations, state='CANCELED')
print(filtered_operations)  # Вывод: [{"id": 615064591, "state": "CANCELED", "date": "2018-10-14T08:21:33.419441"}]

# Сортировка банковских операций по дате
banking_operations = [
    {"id": 41428829, "state": "EXECUTED", "date": "2019-07-03T18:35:29.512364"},
    {"id": 615064591, "state": "CANCELED", "date": "2018-10-14T08:21:33.419441"}
]
sorted_operations = sort_by_date(banking_operations)
print(sorted_operations)  # Вывод: [{"id": 41428829, "state": "EXECUTED", "date": "2019-07-03T18:35:29.512364"},{"id": 615064591, "state": "CANCELED", "date": "2018-10-14T08:21:33.419441"}] 
```
---
## Описание модуля `generators`
Модуль `generators` предоставляет функции:
`filter_by_currency` для итерации по банковским операциям в соответствии с заданной валютой;
`transaction_descriptions` для возврата информации о проведенных банковских операциях;
`card_number_generator` для генерации номеров банковских карт формата `ХХХХ ХХХХ ХХХХ ХХХХ`.

### Примеры использования модуля `generators`
```python
from src.generators import filter_by_currency, transaction_descriptions, card_number_generator

# Итерация по банковским операциям в соответствии с обозначенной валютой
transactions = [
    {
        "id": 939719570,
        "state": "EXECUTED",
        "date": "2018-06-30T02:08:58.425572",
        "operationAmount": {"amount": "9824.07", "currency": {"name": "USD", "code": "USD"}},
        "description": "Перевод организации",
        "from": "Счет 75106830613657916952",
        "to": "Счет 11776614605963066702",
    },
    {
        "id": 142264268,
        "state": "EXECUTED",
        "date": "2019-04-04T23:20:05.206878",
        "operationAmount": {"amount": "79114.93", "currency": {"name": "USD", "code": "USD"}},
        "description": "Перевод со счета на счет",
        "from": "Счет 19708645243227258542",
        "to": "Счет 75651667383060284188",
    },
    {
        "id": 873106923,
        "state": "EXECUTED",
        "date": "2019-03-23T01:09:46.296404",
        "operationAmount": {"amount": "43318.34", "currency": {"name": "руб.", "code": "RUB"}},
        "description": "Перевод со счета на счет",
        "from": "Счет 44812258784861134719",
        "to": "Счет 74489636417521191160",
    }]
filtered_by_rub = filter_by_currency(transactions, 'руб.')
print(filtered_by_rub)  # Вывод: {
        # "id": 873106923,
        # "state": "EXECUTED",
        # "date": "2019-03-23T01:09:46.296404",
        # "operationAmount": {"amount": "43318.34", "currency": {"name": "руб.", "code": "RUB"}},
        # "description": "Перевод со счета на счет",
        # "from": "Счет 44812258784861134719",
        # "to": "Счет 74489636417521191160",}

# Получение информации о банковских операциях
descriptions = transaction_descriptions(transactions)
print(', '.join(list(descriptions)))  # Вывод: Перевод организации, Перевод со счета на счет, Перевод со счета на счет

# Генерация номеров карт
list_card_number = list(card_number_generator(7596270318392845, 7596270318392849))
print(list_card_number) # Вывод: ['7596 2703 1839 2845', '7596 2703 1839 2846', '7596 2703 1839 2847', '7596 2703 1839 2848']
```
## Описание модуля `decorators`
Модуль `decorators` предоставляет функцию-декоратор:
`log` для ведения логов. Записывает лог в файл, если задано имя файла, и в консоль - если нет.
---
## Тестирование функций
В проект добавлена возможность протестировать все созданные функции с использованием pytest.

Команда для запуска тестирования:
`pytest `

Команда для генерации отчета о покрытии:
`pytest --cov=src --cov-report=html`
---
### Тестирование функций модуля `masks`
Тестирование функции `get_mask_card_number` включает в себя:

* Позитивный тест с использованием фикстуры.

* Негативные тесты с использованием параметризации: 
   * пустая строка;
   * короткий номер;
   * длинный номер;
   * номера с дополнительными пробелами и дефисами;
   * строка с использованием буквенных символов;
   * строка формата "Карта номер".

Тестирование функции `get_mask_account` включает в себя:

* Позитивный тест с использованием фикстуры.

* Негативные тесты с использованием параметризации:
  * пустая строка;
  * короткий номер;
  * длинный номер;
  * номера с дополнительными пробелами и дефисами;
  * строка с использованием буквенных символов;
  * строка формата "Счет номер".
---
### Тестирование функций модуля `widget`
Тестирование функции `mask_account_card` включает в себя:

* Позитивные тесты с использованием параметризации для разных счетов и номеров карт различных платежных систем:
  * Visa Gold;
  * Maestro;
  * MasterCard;
  * Visa Classic;
  * Visa Platinum;
  * Карта вашего банка;
  * Вариации "Счёт" и "Счет".

* Негативные тесты с использованием параметризации:
  * пустая строка; 
  * строки, содержащие только числовые символы;
  * строки, состоящие из буквенных символов;
  * строки формата "Карта номер" и "Счет номер" с использованием дополнительных пробелов внутри номеров.

Тестирование функции `get_date` включает в себя:

* Позитивный тест с использованием фикстуры.

* Негативные тесты с использованием параметризации:
  * пустая строка;
  * строки с некорректным форматом даты;
  * строка с пограничным значением даты.
---
### Тестирование функций модуля `processing`

* Тестирование функций `filter_by_state` и `sort_by_date` с использованием фикстуры и значений по умолчанию:
  * Позитивный тест;
  * Негативный тест - передан список словарей с некорректными ключами и их значениями.

* Тестирование функции `filter_by_state` с использованием параметризации и передачей разных аргументов:
  * позитивные тесты при передаче корректных аргументов "CANCELED" и "EXECUTED";
  * негативные тесты при передаче некорректных данных, а также пустой строки.

* Тестирование функции `sort_by_date` с использованием параметризации и передачей разных аргументов:
  * True;
  * False;
  * None;
  * пустая строка;
  * строка с пробелом (не пустая строка).
  
Особенность работы дополнительных аргументов функции `sort_by_date` заключается в типе параметров bool, при которой любая непустая строка равнозначна значению True, а пустая строка и значение None равнозначно значению False.

---
### Тестирование функций модуля `generators`
Тестирование функции `filter_by_currency` включает в себя:

* Позитивные тесты с использованием фикстуры для разных валют:
  * USD;
  * руб.

* Негативные тесты с использованием фикстуры:
  * строка с неверно заданной валютой;
  * пустой список в качестве входного значения.

Тестирование функции `transaction_descriptions` включает в себя:

* Позитивный тест с использованием фикстуры.

* Негативные тесты с использованием параметризации:
  * ключ отсутствует в словаре;
  * пустой список.

Тестирование функции `card_number_generator` включает в себя:

* тест для проверки формата номеров карт
* тест на генерацию номеров в заданном диапазоне
* тест на граничные значения

---
### Тестирование функций модуля `decorators`
Тестирование функции `log` включает в себя:

* Позитивные тесты `test_log_success` и `test_log_to_file`:
  * без указания файла
  * с указанием файла.

* Негативные тесты `test_log_error` и `test_log_error_file`:
  * без указания файла
  * с указанием файла

---